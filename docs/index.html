<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>Путеводитель по Батуми</title>

    <!-- Telegram WebApp API -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="./style.css" />
</head>

<body>
    <div class="wrap">
        <div class="hero">
            <div class="pill">Organic Maps / MAPS.ME · .kmz</div>
            
            <h1>Путеводитель по Батуми</h1>
            <p class="lead">
                Точки на карте: еда, виды, прогулки и полезные места.
                Импортируется одним нажатием в Organic Maps / MAPS.ME.
            </p>
        
            <div class="row">
                <div class="badge">
                <div class="t">Mini-версия</div>
                <div class="v">Бесплатно ✅</div>
            </div>
            <div class="badge">
                <div class="t">Полная версия</div>
                <div class="v">199 ⭐ Stars</div>
            </div>
            <div class="badge">
                <div class="t">Обновления</div>
                <div class="v">Включены ♻️</div>
            </div>
            </div>
        
            <div class="actions">
                <button class="btn" id="mini">✅ Забрать mini-версию</button>
                <button class="btn primary" id="buy">⭐ Купить полную версию (Stars)</button>
                <button class="btn ghost" id="how">❓ Как установить</button>
            </div>
        
            <div class="miniNote">
                После нажатия мини-приложение закроется и бот пришлёт файл в чат.
            </div>
        </div>

        <div class="section">
            <h2>Что внутри</h2>
            <ul class="list">
                <li><b>Сгруппированные точки</b>: еда / кофе / виды / полезное</li>
                <li><b>Пояснения</b> — что выбрать и когда лучше ехать</li>
                <li><b>Можно обновлять</b> — пришлю новую версию (без повторной покупки)</li>
            </ul>

            <div class="hint">
                <div class="icon">ℹ️</div>
                <div>
                    <b>Важно:</b> файл в формате <b>.kmz</b>. Он импортируется в Organic Maps / MAPS.ME одним нажатием.
                </div>
            </div>
        </div>

        <div class="section">
            <h2>FAQ</h2>
            <div class="faq">
                <details>
                    <summary>Где я получу файл после нажатия кнопки?</summary>
                    <p>Файл придёт сообщением от бота прямо в этот чат. Это удобно: скачал → открыл → импортировал.</p>
                </details>

                <details>
                    <summary>Что если у меня нет Stars?</summary>
                    <p>Stars — самый простой вариант внутри Telegram. Позже добавим оплату картой (VISA/MC) отдельной кнопкой.</p>
                </details>

                <details>
                    <summary>Можно ли скачать повторно после покупки?</summary>
                    <p>Да. В чате бота будет кнопка “Скачать ещё раз”, чтобы не искать файл в истории сообщений.</p>
                </details>

                <details>
                    <summary>Будут ли новые города?</summary>
                    <p>Да — план постепенно расширять географию. Покупка привязана к продукту (город/версия).</p>
                </details>
            </div>
        
            <div class="fine">
                Поддержка: если что-то не импортируется — напиши боту, я помогу.
            </div>
        </div>

        <div class="footer">
            © Sale_maps · Batumi Guide · 2026
        </div>
    </div>

    <script>
        const tg = window.Telegram?.WebApp;
        
        // Fallback for opening in a normal browser
        const isTg = !!tg;
        
        function applyTelegramTheme(){
            if (!isTg) return;

            tg.ready();
            tg.expand();

            const css = document.documentElement.style;
            const scheme = (tg.colorScheme || 'dark').toLowerCase();
            const p = tg.themeParams || {};

            // 1) Полная палитра под dark/light — чтобы не было "черный текст на темном фоне"
            if (scheme === 'light') {
                css.setProperty('--bg',    '#f6f7fb');
                css.setProperty('--card',  '#ffffff');
                css.setProperty('--card2', '#ffffff');
                css.setProperty('--text',  '#0f172a');
                css.setProperty('--muted', '#334155');
                css.setProperty('--stroke','rgba(15, 23, 42, .08)');
                css.setProperty('--btn',   '#eef2ff');
                css.setProperty('--btnText','#0f172a');
                css.setProperty('--shadow','0 18px 40px rgba(15, 23, 42, .10)');
            } else {
              // dark (как было)
                css.setProperty('--bg',    '#0b1220');
                css.setProperty('--card',  '#0f1b33');
                css.setProperty('--card2', '#0c172b');
                css.setProperty('--text',  '#e5e7eb');
                css.setProperty('--muted', '#9aa4b2');
                css.setProperty('--stroke','rgba(255,255,255,.08)');
                css.setProperty('--btn',   '#1f2a44');
                css.setProperty('--btnText','#e5e7eb');
                css.setProperty('--shadow','0 18px 40px rgba(0,0,0,.35)');
            }
        
            // 2) Акцент берем из Telegram — чтобы кнопка выглядела "родной"
            if (p.button_color) css.setProperty('--accent', p.button_color);
            if (p.button_text_color) css.setProperty('--accentText', p.button_text_color);
        
            // 3) Подгоним фон/хедер (не везде поддерживается, но пусть будет)
            try { tg.setHeaderColor?.(scheme === 'light' ? '#f6f7fb' : '#0b1220'); } catch(e){}
            try { tg.setBackgroundColor?.(scheme === 'light' ? '#f6f7fb' : '#0b1220'); } catch(e){}
        }


        function haptic(type='impact', style='light'){
            if (!isTg) return;
            try{
                const hf = tg.HapticFeedback;
                if (!hf) return;
                if (type === 'impact') hf.impactOccurred(style);
                if (type === 'notification') hf.notificationOccurred(style);
            }catch(e){}
        }

        function send(action){
            const payload = JSON.stringify({ action });
            if (!isTg){
                alert('Открой это mini-приложение внутри Telegram, чтобы отправить действие боту.\n\nAction: ' + action);
                return;
            }
            tg.sendData(payload);

            // Чтобы пользователь сразу увидел сообщение от бота — закрываем mini app
            setTimeout(() => {
                try { tg.close(); } catch(e){}
            }, 80);
        }

        applyTelegramTheme();

        document.getElementById('mini').onclick = () => { haptic('impact','light'); send("GET_MINI"); };
        document.getElementById('buy').onclick  = () => { haptic('impact','medium'); send("BUY_FULL"); };
        document.getElementById('how').onclick  = () => { haptic('impact','light'); send("HOW_TO"); };
    </script>
</body>
</html>
